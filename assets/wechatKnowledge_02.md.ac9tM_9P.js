import{_ as s,o as a,c as i,R as n}from"./chunks/framework.1nBpG9uI.js";const e="/zhaobao1830-notes/assets/01.uSXj5T2S.png",t="/zhaobao1830-notes/assets/02.d-VyVAIF.png",p="/zhaobao1830-notes/assets/03.KxNFJYaj.png",l="/zhaobao1830-notes/assets/04.sRa-Lrtz.png",h="/zhaobao1830-notes/assets/05.p42lsPp1.png",r="/zhaobao1830-notes/assets/06.GVeNxY-G.png",k="/zhaobao1830-notes/assets/07.1BiXOA-H.png",d="/zhaobao1830-notes/assets/08.4700pAmi.png",E="/zhaobao1830-notes/assets/09.oS-DXPEL.png",o="/zhaobao1830-notes/assets/10.zCpMtUny.png",c="/zhaobao1830-notes/assets/11.5k_oY2nL.png",g="/zhaobao1830-notes/assets/12.oJJA0lCp.png",y="/zhaobao1830-notes/assets/13.DOAc9vPH.png",b="/zhaobao1830-notes/assets/14.M8JJZ6pj.png",D=JSON.parse('{"title":"微信公众号--JSAPI支付","description":"","frontmatter":{},"headers":[],"relativePath":"wechatKnowledge/02.md","filePath":"wechatKnowledge/02.md","lastUpdated":1728526233000}'),m={name:"wechatKnowledge/02.md"},u=n('<h1 id="微信公众号-jsapi支付" tabindex="-1">微信公众号--JSAPI支付 <a class="header-anchor" href="#微信公众号-jsapi支付" aria-label="Permalink to &quot;微信公众号--JSAPI支付&quot;">​</a></h1><p>官网地址：<a href="https://pay.weixin.qq.com/docs/merchant/apis/jsapi-payment/direct-jsons/jsapi-prepay.html" target="_blank" rel="noreferrer">https://pay.weixin.qq.com/docs/merchant/apis/jsapi-payment/direct-jsons/jsapi-prepay.html</a></p><p>参考网站：<a href="https://blog.csdn.net/qq_43890604/article/details/136938311" target="_blank" rel="noreferrer">https://blog.csdn.net/qq_43890604/article/details/136938311</a></p><h2 id="微信公众号配置" tabindex="-1">微信公众号配置 <a class="header-anchor" href="#微信公众号配置" aria-label="Permalink to &quot;微信公众号配置&quot;">​</a></h2><p>官网地址：<a href="https://mp.weixin.qq.com/cgi-bin/home" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/cgi-bin/home</a></p><h3 id="开通网页授权域名" tabindex="-1">开通网页授权域名 <a class="header-anchor" href="#开通网页授权域名" aria-label="Permalink to &quot;开通网页授权域名&quot;">​</a></h3><p><img src="'+e+'" alt="Image text"></p><h3 id="暴露网络授权域名" tabindex="-1">暴露网络授权域名 <a class="header-anchor" href="#暴露网络授权域名" aria-label="Permalink to &quot;暴露网络授权域名&quot;">​</a></h3><p><img src="'+t+'" alt="Image text"></p><h3 id="获取基本配置中的appid、appsecret" tabindex="-1">获取基本配置中的AppID、AppSecret <a class="header-anchor" href="#获取基本配置中的appid、appsecret" aria-label="Permalink to &quot;获取基本配置中的AppID、AppSecret&quot;">​</a></h3><p><img src="'+p+'" alt="Image text"></p><h3 id="微信支付关联商户号" tabindex="-1">微信支付关联商户号 <a class="header-anchor" href="#微信支付关联商户号" aria-label="Permalink to &quot;微信支付关联商户号&quot;">​</a></h3><p><img src="'+l+'" alt="Image text"></p><h2 id="微信支付配置" tabindex="-1">微信支付配置 <a class="header-anchor" href="#微信支付配置" aria-label="Permalink to &quot;微信支付配置&quot;">​</a></h2><p>官网地址：<a href="https://pay.weixin.qq.com/" target="_blank" rel="noreferrer">https://pay.weixin.qq.com/</a></p><h3 id="配置api证书-获取证书序列号" tabindex="-1">配置API证书 获取证书序列号 <a class="header-anchor" href="#配置api证书-获取证书序列号" aria-label="Permalink to &quot;配置API证书 获取证书序列号&quot;">​</a></h3><p><img src="'+h+'" alt="Image text"></p><h3 id="获取正式序列号" tabindex="-1">获取正式序列号 <a class="header-anchor" href="#获取正式序列号" aria-label="Permalink to &quot;获取正式序列号&quot;">​</a></h3><p><img src="'+r+'" alt="Image text"></p><p><img src="'+k+'" alt="Image text"></p><h3 id="设置apiv3秘钥" tabindex="-1">设置APIV3秘钥 <a class="header-anchor" href="#设置apiv3秘钥" aria-label="Permalink to &quot;设置APIV3秘钥&quot;">​</a></h3><p><img src="'+d+'" alt="Image text"></p><h3 id="产品中心—开通jsapi支付" tabindex="-1">产品中心—开通JSAPI支付 <a class="header-anchor" href="#产品中心—开通jsapi支付" aria-label="Permalink to &quot;产品中心—开通JSAPI支付&quot;">​</a></h3><p><img src="'+E+'" alt="Image text"></p><h3 id="添加支付域名配置" tabindex="-1">添加支付域名配置 <a class="header-anchor" href="#添加支付域名配置" aria-label="Permalink to &quot;添加支付域名配置&quot;">​</a></h3><p><img src="'+o+'" alt="Image text"></p><h3 id="暴露域名" tabindex="-1">暴露域名 <a class="header-anchor" href="#暴露域名" aria-label="Permalink to &quot;暴露域名&quot;">​</a></h3><p><img src="'+c+'" alt="Image text"></p><h3 id="appid账号设置-商户关联公众号" tabindex="-1">AppId账号设置-商户关联公众号 <a class="header-anchor" href="#appid账号设置-商户关联公众号" aria-label="Permalink to &quot;AppId账号设置-商户关联公众号&quot;">​</a></h3><p><img src="'+g+'" alt="Image text"></p><h2 id="程序配置" tabindex="-1">程序配置 <a class="header-anchor" href="#程序配置" aria-label="Permalink to &quot;程序配置&quot;">​</a></h2><p>必要配置信息： 公众号appId 公众号appSecret 商户id 证书序列号 商户API秘钥</p><h3 id="配置yml文件" tabindex="-1">配置yml文件 <a class="header-anchor" href="#配置yml文件" aria-label="Permalink to &quot;配置yml文件&quot;">​</a></h3><p><img src="'+y+'" alt="Image text"></p><h3 id="微信支付平台下载的秘钥证书放入项目resources目录下" tabindex="-1">微信支付平台下载的秘钥证书放入项目resources目录下 <a class="header-anchor" href="#微信支付平台下载的秘钥证书放入项目resources目录下" aria-label="Permalink to &quot;微信支付平台下载的秘钥证书放入项目resources目录下&quot;">​</a></h3><p><img src="'+b+`" alt="Image text"></p><h2 id="相关代码" tabindex="-1">相关代码 <a class="header-anchor" href="#相关代码" aria-label="Permalink to &quot;相关代码&quot;">​</a></h2><h3 id="引入相关js" tabindex="-1">引入相关js <a class="header-anchor" href="#引入相关js" aria-label="Permalink to &quot;引入相关js&quot;">​</a></h3><h3 id="jsapi下单" tabindex="-1">JSAPI下单 <a class="header-anchor" href="#jsapi下单" aria-label="Permalink to &quot;JSAPI下单&quot;">​</a></h3><p>后端调用微信提供的接口，生成预支付交易单</p><h3 id="jsapi调起支付" tabindex="-1">JSAPI调起支付 <a class="header-anchor" href="#jsapi调起支付" aria-label="Permalink to &quot;JSAPI调起支付&quot;">​</a></h3><p>前端调用微信提供的方法，调起微信支付</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 统一支付方法</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callPay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeixinJSBridge </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;undefined&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (document.addEventListener) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WeixinJSBridgeReady&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onBridgeReady</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (document.attachEvent) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WeixinJSBridgeReady&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onBridgeReady</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;onWeixinJSBridgeReady&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onBridgeReady</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      onBridgeReady</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onBridgeReady</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* eslint-disable */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  WeixinJSBridge.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">invoke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;getBrandWCPayRequest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;appId&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data.appId,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//公众号ID，由商户传入</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;timeStamp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data.timeStamp,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//时间戳，自1970年以来的秒数</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;nonceStr&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data.nonceStr,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//随机串</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;package&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data.packageVal,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;signType&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data.signType,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//微信签名方式：</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;paySign&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data.paySign </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//微信签名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (res.err_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;get_brand_wcpay_request:ok&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        showToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付成功!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (res.err_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;get_brand_wcpay_request:cancel&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        showToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付过程中用户取消!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (res.err_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;get_brand_wcpay_request:fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        showToast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;支付失败!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="开发遇到的问题" tabindex="-1">开发遇到的问题 <a class="header-anchor" href="#开发遇到的问题" aria-label="Permalink to &quot;开发遇到的问题&quot;">​</a></h2><h3 id="没有调起支付页面" tabindex="-1">没有调起支付页面 <a class="header-anchor" href="#没有调起支付页面" aria-label="Permalink to &quot;没有调起支付页面&quot;">​</a></h3><p>点击支付没有反应</p><p>解决办法：</p><p>1、微信提供的支付必须在微信环境下，如果不是在微信环境下，不会调起支付</p><p>2、查看参数是否有问题，如果调起支付的接口参数传递错误，也不会调起支付</p>`,49),F=[u];function _(q,A,x,f,B,P){return a(),i("div",null,F)}const I=s(m,[["render",_]]);export{D as __pageData,I as default};

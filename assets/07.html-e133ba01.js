import{_ as t,M as o,p as l,q as r,R as s,t as n,N as e,a1 as p}from"./framework-b7c41258.js";const i="/zhaobao1830-notes/assets/01-ba4dee71.png",c="/zhaobao1830-notes/assets/02-8fe7c0a6.png",u={},d=s("h1",{id:"rollup",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#rollup","aria-hidden":"true"},"#"),n(" Rollup")],-1),k=s("h2",{id:"概述",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#概述","aria-hidden":"true"},"#"),n(" 概述")],-1),m={href:"https://www.rollupjs.com/",target:"_blank",rel:"noopener noreferrer"},v=s("code",null,"库和应用",-1),b=p(`<h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><div class="language-npm line-numbers-mode" data-ext="npm"><pre class="language-npm"><code>npm install --global rollup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h2>`,3),g={href:"https://github.com/zhaobao1830/ts-axios-zb",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/zhaobao1830/datav-libs-zb",target:"_blank",rel:"noopener noreferrer"},y=p(`<p>rollup.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> json <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-json&#39;</span>
<span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-typescript2&#39;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-commonjs&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> nodeResolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-node-resolve&#39;</span>
<span class="token keyword">import</span> sourceMaps <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-sourcemaps&#39;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-vue&#39;</span>
<span class="token keyword">import</span> css <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-css-only&#39;</span>

<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./package.json&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> libraryName <span class="token operator">=</span> <span class="token string">&#39;axios-zb&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">src/index.ts</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>main<span class="token punctuation">,</span> <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>module<span class="token punctuation">,</span> <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;es&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">useTsconfigDeclarationDir</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">sourceMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">&#39;bundle.css&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// Indicate here external modules you don&#39;t want to include in your bundle (i.e.: &#39;lodash&#39;)</span>
  <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token string">&#39;src/**&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">备注</p><p>pkg.main、pkg.module是在package.json文件里定义的打包后输出文件，例如：dist/axios.umd.js、dist/axios.es5.js，这块可以自己定义</p></div><h2 id="插件" tabindex="-1"><a class="header-anchor" href="#插件" aria-hidden="true">#</a> 插件</h2>`,4),f={href:"https://www.npmjs.com/package/@rollup/plugin-babel",target:"_blank",rel:"noopener noreferrer"},_={href:"https://www.npmjs.com/package/@rollup/plugin-json",target:"_blank",rel:"noopener noreferrer"},w={href:"https://www.npmjs.com/package/rollup-plugin-typescript2",target:"_blank",rel:"noopener noreferrer"},j={href:"https://www.npmjs.com/package/@rollup/plugin-commonjs",target:"_blank",rel:"noopener noreferrer"},x={href:"https://www.npmjs.com/package/@rollup/plugin-node-resolve",target:"_blank",rel:"noopener noreferrer"},S=s("div",{class:"custom-container tip"},[s("p",{class:"custom-container-title"},"备注"),s("p",null,"封装组件会使用到第三方插件，别人在使用组件打包后的代码，需要将差三分插件也安装，这样太麻烦"),s("p",null,"解决办法是：在封装组件的项目里的rollup.config.js文件里，加入")],-1),q={href:"https://www.npmjs.com/package/rollup-plugin-vue",target:"_blank",rel:"noopener noreferrer"},E={href:"https://www.npmjs.com/package/rollup-plugin-css-only",target:"_blank",rel:"noopener noreferrer"},I={href:"https://www.npmjs.com/package/@rollup/plugin-babel",target:"_blank",rel:"noopener noreferrer"},M={href:"https://www.npmjs.com/package/@babel/core",target:"_blank",rel:"noopener noreferrer"},z={href:"https://www.npmjs.com/package/@babel/preset-env",target:"_blank",rel:"noopener noreferrer"},N=p(`<p>这三个插件一起用，将es6以上的代码转换成es5</p><p>配置:</p><p>rollup.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 用于将es6以上的代码转换成es5</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> babel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@rollup/plugin-babel&#39;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token function">babel</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">&#39;bundled&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&#39;node_modules/**&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.babelrc</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;presets&quot;: [
    &quot;@babel/env&quot;
  ]
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),D={href:"https://www.npmjs.com/package/@rollup/plugin-terser",target:"_blank",rel:"noopener noreferrer"},J=p('<h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题" aria-hidden="true">#</a> 问题</h2><p>1、 Warning: To load an ES module, set &quot;type&quot;: &quot;module&quot; in the package.json or use the .mjs extension.</p><p><img src="'+i+'" alt="Image text"></p><p>原因是：默认情况下，rollup处理的是commonJs格式，这要求项目的所有js文件里，导入导出要用module.export和require。当js文件里使用了import和 export的时候，就会报错</p><p>解决办法：</p><p>第一种、package.json文件里，不加type或设置type为commonJS。项目的js文件里导入导出用module.export和require</p><p>第二种、package.json文件里，设置type为module，项目的js文件里导入导出用import和export</p><p>2、Missing global variable names</p><p><img src="'+c+`" alt="Image text"></p><p>错误原因：在rollup.config.js里通过<code>external: [&#39;vue&#39;]</code>配置了外部引用，缺少全局变量</p><p>解决办法：在output里的输出配置里加上：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;vue&#39;</span><span class="token operator">:</span> <span class="token string">&#39;vue&#39;</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// umd格式，浏览器和node环境都可以用</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>browser<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> libraryName<span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;vue&#39;</span><span class="token operator">:</span> <span class="token string">&#39;vue&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// es 新的打包格式，在html中引用的时候，需要加type=&quot;module&quot;</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>module<span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;es&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;vue&#39;</span><span class="token operator">:</span> <span class="token string">&#39;vue&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 打包成IIFE（自执行函数格式，可以直接在浏览器使用，通过script标签引用）</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>iife<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> libraryName<span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;iife&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;vue&#39;</span><span class="token operator">:</span> <span class="token string">&#39;vue&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="知识点" tabindex="-1"><a class="header-anchor" href="#知识点" aria-hidden="true">#</a> 知识点</h2><h3 id="打包格式种类" tabindex="-1"><a class="header-anchor" href="#打包格式种类" aria-hidden="true">#</a> 打包格式种类</h3><p>1、ESM (ES Modules): 使用 ES 模块的格式进行打包，适用于现代浏览器和支持 ES6 模块的环境。可以通过 output.format 设置为 &#39;es&#39;或&#39;esm‘（这俩种我都试过可以）</p><p>2、CJS (CommonJS): 使用 CommonJS 的格式进行打包，适用于 Node.js 环境和一些旧版浏览器。可以通过 output.format 设置为 &#39;cjs&#39;。</p><p>3、UMD (Universal Module Definition): 使用 UMD 的格式进行打包，支持在不同的环境中使用（浏览器、Node.js），既可以作为全局变量使用，也可以作为模块导入。可以通过 output.format 设置为 &#39;umd&#39;。</p><p>4、AMD (Asynchronous Module Definition): 使用 AMD 的格式进行打包，适用于浏览器环境中使用 AMD 加载器加载模块。可以通过 output.format 设置为 &#39;amd&#39;。</p><p>5、IIFE (Immediately Invoked Function Expression): 使用 IIFE 的自执行函数格式进行打包，将模块包裹在一个立即执行的函数中。适用于直接在浏览器中使用，通过 <code>&lt;script&gt;</code> 标签引入。可以通过 output.format 设置为 &#39;iife&#39;。</p><p>6、SystemJS: 使用 SystemJS 的模块加载器格式进行打包，可以在浏览器和 Node.js 环境下加载。可以通过 output.format 设置为 &#39;system&#39;。</p><div class="custom-container tip"><p class="custom-container-title">备注</p><p>我一般打包方式选1、3、5</p></div>`,23);function C(R,A){const a=o("ExternalLinkIcon");return l(),r("div",null,[d,k,s("p",null,[s("a",m,[n("Rollup"),e(a)]),n(" 是一个 JavaScript 模块打包工具，可以将多个小的代码片段编译为完整的"),v,n("。")]),b,s("p",null,[n("项目地址1(这个版本有点老)："),s("a",g,[n("https://github.com/zhaobao1830/ts-axios-zb"),e(a)])]),s("p",null,[n("项目地址2(最新版本): "),s("a",h,[n("https://github.com/zhaobao1830/datav-libs-zb"),e(a)])]),y,s("p",null,[n("1、"),s("a",f,[n("@rollup/plugin-babel"),e(a)]),n(" 用于转换es代码")]),s("p",null,[n("2、"),s("a",_,[n("@rollup/plugin-json"),e(a)]),n(" 将.json文件转换为ES6模块")]),s("p",null,[n("3、"),s("a",w,[n("rollup-plugin-typescript2"),e(a)]),n(" 处理typeScript")]),s("p",null,[n("4、"),s("a",j,[n("@rollup/plugin-commonjs"),e(a)]),n(" 用于将CommonJS模块转换为ES6")]),s("p",null,[n("5、"),s("a",x,[n("@rollup/plugin-node-resolve"),e(a)]),n(" rollup默认只能处理相对路径的模块，使用这个插件可以引入node_modules中的模块，rollup中 配置该插件后，打包的时候可以将项目中")]),S,s("p",null,[n("6、"),s("a",q,[n("rollup-plugin-vue"),e(a)]),n(" vue插件")]),s("p",null,[n("7、"),s("a",E,[n("rollup-plugin-css-only"),e(a)]),n(" css插件")]),s("p",null,[n("8、"),s("a",I,[n("@rollup/plugin-babel"),e(a)])]),s("p",null,[s("a",M,[n("@babel/core"),e(a)])]),s("p",null,[s("a",z,[n("@babel/preset-env"),e(a)])]),N,s("p",null,[n("9、"),s("a",D,[n("@rollup/plugin-terser"),e(a)]),n(" 对代码进行压缩")]),J])}const V=t(u,[["render",C],["__file","07.html.vue"]]);export{V as default};

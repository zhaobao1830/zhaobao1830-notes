import{_ as e,M as o,p as c,q as l,R as s,t,N as p,a1 as n}from"./framework-b7c41258.js";const i="/zhaobao1830-notes/assets/01-112532b8.png",u="/zhaobao1830-notes/assets/02-00d74317.png",r="/zhaobao1830-notes/assets/04-a29eab70.png",d="/zhaobao1830-notes/assets/05-32c3370b.png",k="/zhaobao1830-notes/assets/06-45fb6c7d.png",g="/zhaobao1830-notes/assets/07-540c5e20.png",v="/zhaobao1830-notes/assets/08-e2b9700b.png",m="/zhaobao1830-notes/assets/03-c61ea537.png",b={},h=n('<h1 id="环境隔离" tabindex="-1"><a class="header-anchor" href="#环境隔离" aria-hidden="true">#</a> 环境隔离</h1><p>maven环境隔离就是不同环境进行不同的配置，打包的时候，调用对应的配置</p><h2 id="为什么" tabindex="-1"><a class="header-anchor" href="#为什么" aria-hidden="true">#</a> 为什么</h2><p>在项目开发中，开发、测试、生产环境的配置都不一样，如果每次都手动改变配置，容易改错，这时我们可以使用Maven</p><h2 id="spring-mvc" tabindex="-1"><a class="header-anchor" href="#spring-mvc" aria-hidden="true">#</a> spring MVC</h2>',5),y={href:"https://coding.imooc.com/lesson/162.html#mid=9001",target:"_blank",rel:"noopener noreferrer"},_=n('<h2 id="旧项目结构" tabindex="-1"><a class="header-anchor" href="#旧项目结构" aria-hidden="true">#</a> 旧项目结构</h2><p><img src="'+i+'" alt="Image text"></p><p>以下文件是不同环境单独配置的：</p><p>datasource.properties 数据库配置文件</p><p>logback.xml logback配置文件</p><p>mmall.properties ftp服务器配置</p><p>zfbinfo.properties 支付宝支付功能配置</p><h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤" aria-hidden="true">#</a> 步骤</h2><p>一、创建不同的配置文件</p><p><img src="'+u+`" alt="Image text"></p><p>二、修改pom.xml文件</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources.\${deploy.type}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>*.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>包裹在build中</p><p>这里的directory中配置了隔离文件的路径，\${deploy.type}指的是将要隔离出来的文件的名称，将会在profiles结点中配置</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deploy.type</span><span class="token punctuation">&gt;</span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>deploy.type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>beta<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deploy.type</span><span class="token punctuation">&gt;</span></span>beta<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>deploy.type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>prod<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deploy.type</span><span class="token punctuation">&gt;</span></span>prod<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>deploy.type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>和build同级</p><p>配置了activeByDefault结点为true，表示当不选择编译环境时，默认使用dev（开发）环境，这也是推荐的配置。上述提到的deploy.type将会直接从这里的deploy.type中拿值，来表示是哪个编译环境。</p><p>三、打包</p><p>（一）、使用maven命令打包</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mvn clean package -Dmaven.test.skip=true -Pdev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-Pdev 表示dev环境</p><p>-Pbeta 表示beta环境</p><p>-Pprod 表示prod环境</p><p>-Dmaven.test.skip=true 表示不执行测试用例，也不编译测试用例类</p><div class="custom-container tip"><p class="custom-container-title">备注</p><p>Unknown lifecycle phase “.test.skip=true“. You must specify a valid lifecycl</p><p>解决办法：</p><p>只需要加在此参数外加单引号即可，即：mvn package &#39;-Dmaven.test.skip=true&#39;。</p><p>或</p><p>切换idea的终端为Command Prompt</p><p>原因：</p><p>idea默认的终端是Windows PowerShell，在 PowerShell 下，参数 -Dmaven.test.skip=true 没有被正确地识别。</p></div><p>（二）、使用idea打包</p><p>1、右侧maven选择要打包部署的配置，一般是选择的dev</p><p><img src="`+r+'" alt="Image text"></p><p>2、在idea中，配置tomcat</p><p><img src="'+d+'" alt="Image text"></p><p><img src="'+k+'" alt="Image text"></p><p>3、点击启动按钮</p><p><img src="'+g+'" alt="Image text"></p><p>4、执行完后，打开tomcat目录中的webapps文件夹，里面就有打包好的项目</p><p><img src="'+v+'" alt="Image text"></p><h2 id="spring-boot" tabindex="-1"><a class="header-anchor" href="#spring-boot" aria-hidden="true">#</a> spring-boot</h2>',36),x={href:"https://class.imooc.com/lesson/1203#mid=30856",target:"_blank",rel:"noopener noreferrer"},f=n('<p>新建dev和prod文件，存放开发环境和生产环境的配置</p><p><img src="'+m+`" alt="Image text"></p><p>application-dev.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/foodie<span class="token punctuation">-</span>shop<span class="token punctuation">-</span>dev<span class="token punctuation">?</span>characterEncoding=UTF<span class="token punctuation">-</span>8<span class="token important">&amp;serverTimezone=GMT%2B8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> x5219438
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml 通过active来切换当前环境的配置</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">#环境配置 dev就是新建的application-dev.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6);function z(I,B){const a=o("ExternalLinkIcon");return c(),l("div",null,[h,s("p",null,[s("a",y,[t("地址链接"),p(a)])]),_,s("p",null,[s("a",x,[t("地址链接"),p(a)])]),f])}const P=e(b,[["render",z],["__file","01.html.vue"]]);export{P as default};

import{_ as e,M as o,p as c,q as i,R as n,t as s,N as t,a1 as a}from"./framework-b7c41258.js";const l={},u=a('<h1 id="多例模式" tabindex="-1"><a class="header-anchor" href="#多例模式" aria-hidden="true">#</a> 多例模式</h1><h2 id="概念" tabindex="-1"><a class="header-anchor" href="#概念" aria-hidden="true">#</a> 概念</h2><p>单例模式指的是每次生成的对象都是同一个</p><p>多例模式指的是每次新建的对象都不一样</p><p>Spring boot默认注入的服务，都是单例模式</p><p>单例模式带来的问题是私有的成员变量（private定义的变量）只能通过@Autowired注入</p><p>如果一个类里面有@Autowired，那这个类必须放到SpringBoot容器里</p><p>对于一个加入到SpringBoot容器里的bean，使用的时候通过@Autowired注入</p><h2 id="单例模式" tabindex="-1"><a class="header-anchor" href="#单例模式" aria-hidden="true">#</a> 单例模式</h2><p>pring boot默认注入的服务，都是单例模式</p><p>单例模式带来的问题是私有的成员变量（private定义的变量）只能通过@Autowired注入</p><p>如果一个类里面有@Autowired，那这个类必须放到SpringBoot容器里</p><p>对于一个加入到SpringBoot容器里的bean，使用的时候通过@Autowired注入</p><h2 id="需求和使用" tabindex="-1"><a class="header-anchor" href="#需求和使用" aria-hidden="true">#</a> 需求和使用</h2>',14),k={href:"https://github.com/zhaobao1830/misszb",target:"_blank",rel:"noopener noreferrer"},r=a(`<p>封装CouponChecker优惠券校验类，不同用户的不同订单都需要用这个类进行校验，那需要多例模式</p><p>如果用@Autowired注入，那就是单例模式，相当于每次修改CouponChecker类里的变量，这样不好</p><p>最佳使用方式是：new CouponChecker()，将需要的参数传入到CouponChecker类中并赋值到定义的私有变量上</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>logic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>bo<span class="token punctuation">.</span></span><span class="token class-name">SkuOrderBO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span><span class="token class-name">CouponType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>core<span class="token punctuation">.</span>money<span class="token punctuation">.</span></span><span class="token class-name">IMoneyDiscount</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ForbiddenException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ParameterException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Category</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Coupon</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lin<span class="token punctuation">.</span>missyou<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CommonUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CouponChecker</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Coupon</span> coupon<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">IMoneyDiscount</span> iMoneyDiscount<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CouponChecker</span><span class="token punctuation">(</span><span class="token class-name">Coupon</span> coupon<span class="token punctuation">,</span><span class="token class-name">IMoneyDiscount</span> iMoneyDiscount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>coupon <span class="token operator">=</span> coupon<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>iMoneyDiscount <span class="token operator">=</span> iMoneyDiscount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> isInTimeline <span class="token operator">=</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">isInTimeLine</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInTimeline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ForbiddenException</span><span class="token punctuation">(</span><span class="token number">40007</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Mark</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finalTotalPriceIsOk</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuOrderBO</span><span class="token punctuation">&gt;</span></span> skuOrderBOList<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span> orderFinalTotalPrice<span class="token punctuation">,</span>
                                    <span class="token class-name">BigDecimal</span> serverTotalPrice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> serverFinalTotalPrice<span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token class-name">CouponType</span><span class="token punctuation">.</span><span class="token function">toType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">FULL_MINUS</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token constant">NO_THRESHOLD_MINUS</span><span class="token operator">:</span>
                serverFinalTotalPrice <span class="token operator">=</span> serverTotalPrice<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getMinus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>serverFinalTotalPrice<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ForbiddenException</span><span class="token punctuation">(</span><span class="token number">50008</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">FULL_OFF</span><span class="token operator">:</span>
                <span class="token class-name">BigDecimal</span> orderCategoryPrice <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">canBeUsed</span><span class="token punctuation">(</span>skuOrderBOList<span class="token punctuation">,</span> serverTotalPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">BigDecimal</span> discountPrice <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>iMoneyDiscount<span class="token punctuation">.</span><span class="token function">discount</span><span class="token punctuation">(</span>orderCategoryPrice<span class="token punctuation">,</span>  <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                serverFinalTotalPrice <span class="token operator">=</span> serverTotalPrice<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>discountPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ParameterException</span><span class="token punctuation">(</span><span class="token number">40009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> compare <span class="token operator">=</span> serverFinalTotalPrice<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>orderFinalTotalPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>compare <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ForbiddenException</span><span class="token punctuation">(</span><span class="token number">50008</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">canBeUsed</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuOrderBO</span><span class="token punctuation">&gt;</span></span> skuOrderBOList<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span> serverTotalPrice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 订单中满足优惠条件的金额</span>
        <span class="token class-name">BigDecimal</span> orderCategoryPrice<span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getWholeStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            orderCategoryPrice <span class="token operator">=</span> serverTotalPrice<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> cidList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getCategoryList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Category</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderCategoryPrice <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSumByCategoryList</span><span class="token punctuation">(</span>skuOrderBOList<span class="token punctuation">,</span> cidList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">couponCanBeUsed</span><span class="token punctuation">(</span>orderCategoryPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> orderCategoryPrice<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">couponCanBeUsed</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> orderCategoryPrice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token class-name">CouponType</span><span class="token punctuation">.</span><span class="token function">toType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">FULL_OFF</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token constant">FULL_MINUS</span><span class="token operator">:</span>
                <span class="token comment">// 不够满减条件</span>
                <span class="token keyword">int</span> compare <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coupon<span class="token punctuation">.</span><span class="token function">getFullMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>orderCategoryPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>compare <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ParameterException</span><span class="token punctuation">(</span><span class="token number">40008</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">NO_THRESHOLD_MINUS</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ParameterException</span><span class="token punctuation">(</span><span class="token number">40009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> <span class="token function">getSumByCategoryList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuOrderBO</span><span class="token punctuation">&gt;</span></span> skuOrderBOList<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> cidList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> sum <span class="token operator">=</span> cidList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>cid <span class="token operator">-&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSumByCategory</span><span class="token punctuation">(</span>skuOrderBOList<span class="token punctuation">,</span> cid<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> <span class="token function">getSumByCategory</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuOrderBO</span><span class="token punctuation">&gt;</span></span> skuOrderBOList<span class="token punctuation">,</span> <span class="token class-name">Long</span> cid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> sum <span class="token operator">=</span> skuOrderBOList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>sku <span class="token operator">-&gt;</span> sku<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SkuOrderBO</span><span class="token operator">::</span><span class="token function">getTotalPrice</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注入多例bean" tabindex="-1"><a class="header-anchor" href="#注入多例bean" aria-hidden="true">#</a> 注入多例Bean</h2>`,5),d={href:"https://github.com/zhaobao1830/misszb",target:"_blank",rel:"noopener noreferrer"},m=a(`<p>一般来说，我们使用@Autowired注入进来的Bean都是单例Bean，如果想注入多例Bean，可以使用ObjectFactory和@Scope俩种方式</p><h3 id="objectfactory" tabindex="-1"><a class="header-anchor" href="#objectfactory" aria-hidden="true">#</a> ObjectFactory</h3><p>注入的时候用ObjectFactory包裹</p><p>Test.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zb<span class="token punctuation">.</span>misszb<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Scope</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;zhaobao&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Test</span><span class="token punctuation">&gt;</span></span> test<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="scope" tabindex="-1"><a class="header-anchor" href="#scope" aria-hidden="true">#</a> @Scope</h3><p>Test.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zb<span class="token punctuation">.</span>misszb<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Scope</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ScopedProxyMode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;prototype&quot;</span><span class="token punctuation">,</span> proxyMode <span class="token operator">=</span> <span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span><span class="token constant">TARGET_CLASS</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;zhaobao&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注入</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Test</span> test<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">备注</p><p>通过ObjectFactory注入的多例对象可以正常通过set方法赋值</p><p>通过@Scope注入的多例对象通过调试发现是动态代理类, 无法通过set方法赋值</p><p>推测下原因：因为开启多例，又开启了CGLIb的代理模式，</p><p>那么就会出现这种问题：</p><p>由于开启了代理，所以每次访问this.test获取到的都是不同对象</p><p>this.test.set是对A实例赋值</p><p>而this.test.get 相当于获取了另外一个实例B的属性值</p></div>`,12);function v(b,y){const p=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("项目："),n("a",k,[s("misszb/OrderServiceImpl"),t(p)])]),r,n("p",null,[s("项目："),n("a",d,[s("misszb/TestController"),t(p)])]),m])}const g=e(l,[["render",v],["__file","22.html.vue"]]);export{g as default};
